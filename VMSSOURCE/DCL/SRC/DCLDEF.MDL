;
;	DCL Command Language Interpreter internal structure definitions
;
; IDENT	'V04-001'
;

;
;****************************************************************************
;*									    *
;*  COPYRIGHT (c) 1978, 1980, 1982, 1984 BY				    *
;*  DIGITAL EQUIPMENT CORPORATION, MAYNARD, MASSACHUSETTS.		    *
;*  ALL RIGHTS RESERVED.						    *
;* 									    *
;*  THIS SOFTWARE IS FURNISHED UNDER A LICENSE AND MAY BE USED AND COPIED   *
;*  ONLY IN  ACCORDANCE WITH  THE  TERMS  OF  SUCH  LICENSE  AND WITH THE   *
;*  INCLUSION OF THE ABOVE COPYRIGHT NOTICE. THIS SOFTWARE OR  ANY  OTHER   *
;*  COPIES THEREOF MAY NOT BE PROVIDED OR OTHERWISE MADE AVAILABLE TO ANY   *
;*  OTHER PERSON.  NO TITLE TO AND OWNERSHIP OF  THE  SOFTWARE IS  HEREBY   *
;*  TRANSFERRED.							    *
;* 									    *
;*  THE INFORMATION IN THIS SOFTWARE IS  SUBJECT TO CHANGE WITHOUT NOTICE   *
;*  AND  SHOULD  NOT  BE  CONSTRUED AS  A COMMITMENT BY DIGITAL EQUIPMENT   *
;*  CORPORATION.							    *
;* 									    *
;*  DIGITAL ASSUMES NO RESPONSIBILITY FOR THE USE  OR  RELIABILITY OF ITS   *
;*  SOFTWARE ON EQUIPMENT WHICH IS NOT SUPPLIED BY DIGITAL.		    *
;* 									    *
;*									    *
;****************************************************************************
;

;++
; FACILITY:  DCL Command Language Interpreter
;
; ABSTRACT:
;
;	These are the structure definitions used by the DCL
;	command interpreter.
;
; ENVIRONMENT:
;
;	VAX/VMS operating system. supervisor mode.
;
; AUTHOR:  Tim Halvorsen, Feb 1980
;
; Modified by:
;
;	V04-001	HWS0106		Harold Schultz	07-Sep-1984
;		Add PRC_W_ASTSTATUS,PRC_W_ASTIOSB, and PRC_W_ASTRETN
;		to store status data from the CNTL-Y AST routine.
;
;	V03-025 HWS0087		Harold Schultz	20-Jul-1984
;		Change order in DCL table so that FLAGS will not
;		be on the end. Fixes problem were a BLBx is used
;		to interrogate the flag and causes an accvio if the
;		three bytes past FLAGS (FLAGS is last allocated byte)
;		are not readable. (BLBx instructions use longword
;		context, which when applied to FLAGS causes FLAGS + the
;		next three bytes to be accessed).
;		Add PRC_B_EXONLYL to store indirect level of first
;		encountered exe-only procedure. Add PRC_V_SAVCMDV and
;		PRC_V_SAVIMGV to store saved command and image verification
;		modes. (Make PRC_V_EXEPROC obsolete)
;
;	V03-024	HWS0045		Harold Schultz	30-Mar-1984
;		Add TABLE flag to SPWN_W_FLAGS.
;		Add SPWN_Q_TABLE.
;		Add WRK_V_CLOSERR to WRK_W_FLAGS2
;
;	V03-023	HWS0035		Harold Schultz	21-Mar-1984
;		Add IRUNDWN flag to new flag byte IMGFLAG to track 
;		image rundown.
;
;	V03-022	HWS0007		Harold Schultz	13-Feb-1984
;		Add PRC_V_CARRCNTL for prompt string carriagecontrol
;		(in FLAGS)
;		Add PRC_L_STS and PRC_L_STV
;		Add SPWN_V_NOCTX
;
;	V03-021	PCG0027		Peter George	06-Feb-1984
;		Add CTX_V_CTRLY and CTX_V_CTRLT.
;
;	V03-020	PCG0026		Peter George	11-Jan-1984
;		Add PRC_L_IMGACTSTS.
;
;	V03-019	PCG0025		Peter George	11-Jan-1984
;		Add EDIT_V_LOWERCASE.
;
;	V03-018	PCG0024		Peter George	03-Jan-1984
;		Change PRC_V_REPROMPT to PRC_V_FLUSH.
;
;	V03-017	PCG0023		Peter George	01-Dec-1983
;		Add ERASE keypad flag.
;
;	V03-016	PCG0022		Peter George	07-Sep-1983
;		Add OUTFLAGS to OUT, PRC, and IDF.
;
;	V03-015	PCG0021		Peter George	16-Aug-1983
;		Add WAIT bit to CTX.
;
;	V03-014	PCG0020		Peter George	27-Jun-1983
;		Add SPWN_V_CLI and SPWN_Q_CLI.
;		Add PRC_W_WAITIOSB and WRK_L_SIGNALRTN.
;		Incr size of WRK_C_RECALLMAX.
;
;	V03-013	PCG0019		Peter George	01-Jun-1983
;		Remove PRC_L_TAB_VEC.  Incr size of token buffer.
;		Add SPWN_V_KEYPAD.
;
;	V03-012	RAS0157		Ron Schaefer	17-May-1983
;		Add support for new logical names services to CTX.
;
;	V03-011	PCG0018		Peter George	03-May-1983
;		Add PRC_Q_FLUSHTIME and CTX_V_VERIMAGE.
;
;	V03-010	PCG0017		Peter George	20-Apr-1983
;		Add prompt string and keypad state to CTX.
;		Add prompt string and new flags to SPWN.
;		Add output mailbox info to PRC.
;
;	V03-009	PCG0016		Peter George	30-Mar-1983
;		Add PRC_V_VERIMAGE.
;		Add SPWN_T_PROCESS.
;		Increase WRK_C_RSLBUFSIZ.
;		Increase size of recall buffer.
;
;	V03-008	PCG0015		Peter George	29-Mar-1983
;		Fix CTX_C_KEY* definitions.
;
;	V03-006	PCG0014		Peter George	17-Feb-1983
;		Make too many changes to meaningfully list here.
;
;	V03-005	PCG0013		Peter George	28-Jan-1983
;		Remove the ONEXIT bit from PRC.
;		Add SPWN_V_NOTIFY and SPWN_V_CONTINUE.
;
;	V03-004	PCG0012		Peter George	01-Dec-1982
;		Uncomment part of PRC data structure.
;		Excess ERRRAB and ERRIFI.
;		Add SYS$OUTPUT PRC fields.
;		Add OUT data structure.
;		Add IDF_L_FILENAME.
;
;	V03-003	PCG0011		Peter George	16-Nov-1982
;		Reorganize WRK block.
;		Remove WRK_C_DCLBUFSIZ, WRK_G_DCLPRSBUF, WRK_G_RECORD.
;		Increase size of command buffers.
;		Add slopover for input buffer - used by LIB$DO_COMMAND.
;		Add SIZE field to TMBX.
;
;	V03-002	PCG0010		Peter George	25-Oct-1982
;		Add PROMPT entities.  Add DCL_V_NEXTQUAL flag.
;
;	V03-001	PCG0009		Peter George	21-Jun-1982
;		Add PTR_V_KEYWORD, PTR_V_SYNTAX, PTR_K_IGNORE, PTR_B_LEVEL,
;			and PTR_B_NUMBER.
;		Add WRK_L_PROMPTRTN, WRK_V_CONTIN, WRK_B_VALLEV, and 
;			WRK_V_USRMODE. Delete WRK_V_QUAL.
;		Double size of WRK_G_RESULT.
;		Add PRC_G_COMMANDS, PRC_L_NXTCMDPTR, and PRC_V_REPROMPT.
;		Add DCL_L_ENTITY, DCL_L_TOKEN, DCL_L_GETVM, DCL_L_FREEVM,
;			DCL_W_BUFLEN, DCL_W_DEFLEN, and DCL_L_DEFADDR.
;		Add PLM_B_QUADESC.
;
;--

;
;	DEFINE PROCESS WORK AREA (BASED AT R11=CTL$AG_CLIDATA)
;

	STRUCT	PRC
	F	SAVAP		; SAVED ARGUMENT POINTER
	F	SAVFP		; SAVED FRAME POINTER
	F	INPRAB		; ADDRESS OF INPUT RAB
	F	OUTRAB		; ADDRESS OF OUTPUT RAB
	F	TRMLIST		; ADDRESS OF XABTRM ITEM LIST
	F	INDINPRAB	; ADDRESS OF INDIRECT INPUT RAB
	F	INDOUTRAB	; ADDRESS OF INDIRECT OUTPUT RAB
	F	INDFAB		; ADDRESS OF INDIRECT FAB
	F	ALLOCREG,Q	; SYMBOL ALLOCATION REGION LISTHEAD
	F	GLOBAL,Q	; GLOBAL SYMBOL TABLE LISTHEAD
	F	LABEL,Q		; LABEL SYMBOL TABLE LISTHEAD
	F	LOCAL,Q		; LOCAL SYMBOL TABLE LISTHEAD
	F	KEYPAD,Q	; KEYPAD SYMBOL TABLE LISTHEAD
	F	CURRKEY		; ADDRESS OF CURRENT KEY STATE
	F	LASTKEY		; ADDRESS OF LOCKED KEY STATE
	F	SEVERITY	; ADDRESS OF ERROR SEVERITY SYMBOL VALUE
	F	STATUS		; ADDRESS OF COMPLETION STATUS VALUE
	F	RESTART		; ADDRESS OF RESTART VALUE
	F	INDEPTH		; INDIRECT STACK DEPTH (# LEVELS DEEP)
	F	SYMBOL		; ADDRESS OF GOTO LABEL TABLE ENTRY
	F	INPCHAN,W	; INPUT CHANNEL FOR INTERACTIVE JOBS
	F	WAITIOSB,W	; WAIT COMMAND IOSB
	F	FLAGS,W		; PROCESS LEVEL FLAGS
	V	<M
		CARRCNTL	; CARRIAGE CONTROL IN PROMPT STRING FLAG
		CNTRLY		; SUPERVISOR CONTROL Y/C LEVEL REQUEST
		DISABL		; DISABLE CONTROL Y AST'S
		EXIT		; EXIT HANDLER ESTABLISHED
		GOTO		; FORWARD GOTO IN PROGRESS
		IND		; PROCESSING INDIRECT FILE
		MODE		; COMMAND PROCESSING MODE (BATCH=1, INTER=0)
		VERIFY		; VERIFY LINES OF INDIRECT COMMAND FILES
		AUTOLOGO	; SILENT LOGOUT ($DELPRC) ON NEXT LEVEL 0 $GET
		DBGQUAL		; DEBUG QUALIFIER SEEN ON COMMAND
		DBGTRUE		; STATE OF DEBUG WAS TRUE
		YLEVEL		; RUNNING AT CONTROL Y LEVEL
		HANGUP		; TERMINAL HANGUP PENDING
		PAUSE		; CLI PAUSE STATE ACTIVE
		EOFLOGO		; SILENT LOGOUT ($DELPRC) ON LEVEL 0 EOF
		DETACHED	; TERMINAL IS DETACHED FROM THIS PROCESS
		>
	F	ONLEVEL,W	; ON ERROR LEVEL NUMBER
	F	ONERROR		; ADDRESS OF ON CONDITION COMMAND TEXT
	F	PPFLIST		; LISTHEAD OF OPEN PPF RAB'S (VIA OPEN COMMAND)
	F	TMBX,L		; LISTHEAD OF TERMINATION MAILBOX STORAGE
				; BLOCKS; FOR EACH TERMINATION MAILBOX CREATED
	F	IMGFLAG,B	; IMAGE CONTROL FLAGS
	V	<M
		IRUNDWN		; IMAGE RUNDOWN FLAG
		>
	F	,B,1		; SPARE
	F	ATTMBX,W	; CHANNEL TO MAILBOX FOR RE-ATTACH REQUESTS
	F	INDCLOCK	; TOTAL INDIRECT STACKS & UNSTACKS
	F	IMGACTSTS	; IMAGE ACTIVATOR STATUS
	F	STS		; RMS COMPLETION CODE (STS AND STV ASSUMED
	F	STV		; RMS STATUS VALUE     ALWAYS ADJACENT)
	F	EXTBLK		; EXIT HANDLER CONTROL BLOCK
	F	EXTHND		; EXIT HANDLER ADDRESS
	F	EXTARG		; NUMBER OF EXIT HANDLER ARGUMENTS
	F	EXTPRM		; ADDRESS OF REASON FOR EXIT (BELOW)
	F	EXTCOD		; REASON FOR EXIT
	F	STACKPT		; INDIRECT STACK POINTER
	F	STACKLM		; INDIRECT STACK LIMIT
	F	EXMDEPADR	; "DOT" FOR EXAMINE/DEPOSIT
	F	EXMDEPWID,B	; WIDTH DEFAULT, IE: BYTE,WORD,LONGWORD
	F	EXMDEPMOD,B	; MODE DEFAULT, IE: ASCII,HEX,OCTAL
	F	DEFRADIX,B	; CURRENT DEFAULT RADIX
	C	<,_K_		; PROCESS RADIX TYPES
		HEX		; HEXIDECIMAL
		DEC		; DECIMAL
		OCT		; OCTAL
		>
	F	FLAGS2,B	; PROCESS LEVEL FLAGS (MORE OF THEM)
	V	<M
		CMD		; COMMAND CALLBACK HAS BEEN DONE
		CHAIN		; CHAIN CALLBACK HAS BEEN DONE
		RUNDEF		; USE RUN DEFAULT (NOT EXTERNAL)
		EXEONLY		; IMAGE IS EXECUTE ONLY
		PRIV		; IMAGE IS PRIVILEGED
		EXEPROC		; EXE-ONLY COMMAND PROCEDURE (OBSOLETE)
		FLUSH		; FLUSH THE CURRENT INPUT
		VERIMAGE	; HAVE RMS DO IMAGE VERIFICATION
		>
	F	LSTSTATUS	; LAST STATUS SET (LONGWORD VALUE)
	F	OUTOFBAND	; OUT OF BAND AST ENABLE BITMASK
	V	<M
		,20		; SKIP UNUSED CHARACTERS
		CTRLT		; CONTROL T
		,4		; SKIP UNUSED CHARACTERS
		CTRLY		; CONTROL Y
		>
	F	ONCTLY		; ADDRESS OF ON CONTROL/Y COMMAND TEXT
	F	IDFLNK		; POINTER TO INDIRECT FILE FRAMES
	F	SPWN		; LISTHEAD OF SPAWN STORAGE BLOCKS FOR EACH
				; SUBPROCESS CREATED; SPAWN STORAGE FOR PROCESS
				; CURRENTLY BEING SPAWNED IS FIRST, IF ANY.
	F	ASTSTATUS,W	; SAVED CNTL-Y AST STATUS (TEMPORARY)
	F	ASTIOSB,W	; SAVED CNTL-Y AST REENABLE IOSB (TEMPORARY)
	F	ASTRETN,W	; SAVED CNTL-Y AST REENABLE RETURN STATUS (TMP)
	F	OUTMBXCHN,W	; OUTPUT MAILBOX CHANNEL
	F	OUTMBXSIZ,W	; SIZE OF MAXIMUM OUTPUT MAILBOX MESSAGE
	F	OUTMBXREF,W	; OUTPUT MAILBOX REFERENCE COUNT
	F	FLUSHTIME,Q	; OUTPUT LOG FLUSH RATE
	F	IMAGENAME,Q	; DESCRIPTOR OF CHAIN IMAGE FILE SPECIFICATION
	F	COMMAND,Q	; DESCRIPTOR OF CHAIN COMMAND LINE FOR LATER
	F	SAVEPRIV,Q	; SAVED PRIVILEGED IMAGE PRIVILEGES

;
; Prompt string must be kept together (and mimicked in CTX data structure).
;
	F	PROMPTLEN,B	; LENGTH OF PROMPT STRING
	F	PMPTCTRL,W	; PROMPT CONTROL CHARACTERS
	F	CONTINUE,B	; PROMPT CONTINUATION CHARACTER
	F	PROMPT,G,32	; PROMPT STRING AREA

;
;    OUTIFI, OUTISI, OUTRABCTX, OUTDVI, and OUTFLAGS must be the same in PRC, 
;    IDF, OUT
;
	F	OUTIFI,W	; IFI FOR OUTPUT
	F	OUTISI,W	; ISI FOR OUTPUT
	F	OUTRABCTX	; CONTENTS OF OUTPUT RAB CTX LONGWORD
	F	OUTDVI,T,16	; INDIRECT OUTPUT DEVICE (ASCIC)
	F	OUTFLAGS,B	; FLAGS
	V	<M		;
		OUTCCL		; CONCEALED OUTPUT DEVICE
		INPCCL		; CONCEALED INPUT DEVICE
		SAVCMDV		; SAVED COMMAND VERIFICATION FLAG
		SAVIMGV		; SAVED IMAGE VERIFICATION FLAG
		>		;
	F	EXONLYL,B	; FIRST E-ONLY INDIRECT LEVEL
	F	,B,1		; SPARE

;
; Recall command buffer elements - using them causes the number of indirect
; frames available to shrink.
;
	F	RECALLPTR	; POINTER TO NEXT COMMAND IN BUFFER
	F	COMMANDS,G,1025	; BUFFER OF COMMAND LINES
	C	CMDBUFSIZ,1025	; LENGTH OF COMMAND BUFFER

	L	LENGTH		; LENGTH OF PROCESS WORK AREA
	E


;
;	DEFINE PROCESS RMS DATA AREA
;

	STRUCT	PRD
	F	FAB,G,80		; PROCESS FAB
	F	NAM,G,96		; PROCESS NAME BLOCK
	F	INPRAB,G,68		; INPUT RAB
	F	ALTINPRAB,G,68		; ALTERNATE INPUT RAB
	F	ALTOUTRAB,G,68		; ALTERNATE OUTPUT RAB
	F	OUTRAB,G,68		; OUTPUT RAB
	F	XABTRM,G,36		; TERMINAL XAB
	F	TRMLIST,G,48		; ITEMLIST FOR TERMINAL XAB
	L	LENGTH			; NORMAL LENGTH

;
; FOLLOWING EXTENSION USED ON LEVEL 0 TO STORE FID/DID/FNM FOR QUEUING
; THE JOB LOG FILE TO THE JOB CONTROLLER.
;
	F	OUTDVI,T,16		; DEVICE FOR OUTPUT FILE
	F	OUTFID,W,3		; FILE ID FOR OUTPUT FILE
	F	OUTDID,W,3		; DIRECTORY ID FOR OUTPUT FILE
	F	OUTFNM,T,20		; OUTPUT FILE NAME
	L	XLENGTH			; LENGTH OF EXTENDED BLOCK
	E

;
; OFFSETS OF ITEM IS TERMINAL XAB ITEM LIST.
;
	STRUCT	ITRM
	F	MODLEN,W		; TRM$_MODIFIERS ENTRY
	F	MODCODE,W
	F	MODIFIERS
	F	MODRET
	F	PMPTLEN,W		; TRM$_PROMPT ENTRY
	F	PMPTCODE,W
	F	PMPTADDR
	F	PMPTRET
	L	MINLEN			; MINIMUM ITRM REQUIRED
	F	INILEN,W		; TRM$_INISTRING ENTRY
	F	INICODE,W
	F	INIADDR
	F	INIRET
	F	OFFLEN,W		; TRM$_INIOFFSET ENTRY
	F	OFFCODE,W
	F	OFFSET
	F	OFFRET
	L	LENGTH
	E

;
;	Define command work area (based at R10)
;

	STRUCT	WRK

;
; Work area constant and length definitions
;
	C	<
		CMDBUFSIZ,1024	; EXPANDED COMMAND BUFFER SIZE IN BYTES
		INPBUFSIZ,256	; INPUT BUFFER SIZE IN BYTES
		SCRSTKSIZ,512	; INTERNAL COMMAND SCRATCH STACK SIZE IN BYTES
		MSGBUFSIZ,132	; OUTPUT MESSAGE BUFFER SIZE IN BYTES
		RSLBUFSIZ,128*12; RESULT PARSE BUFFER SIZE IN BYTES (128 MAX)
		RECALLMAX,20	; MAXIMUM NUMBER OF COMMANDS THAT CAN BE RECALLED
		MAXKEYSTATE,255	; MAXIMUM SIZE OF A KEYPAD STATE NAME
		>
	-F	,B,0		; ENDING ADDRESS OF NEGATED STRUCTURE
				; (NEEDED TO OBTAIN LENGTH DEFINITION)
	L	LENGTH		; LENGTH OF COMMAND PARSING WORK AREA

;
; Command buffers and pointers
;
	-F	EXPANDPTR	; EXPANSION BUFFER CHARACTER POINTER
	-F	MARKPTR		; POINTER INTO EXPANSION BUFFER OF THE CURRENT
				; SEGMENT BEING PARSED
	-F	CHARPTR		; INPUT BUFFER CHARACTER POINTER
	-F	BUFFER,G,1024	; COMMAND EXPANSION BUFFER
	-F	,B,4		; 4 BYTES BEFORE INPUT BUFFER FOR SLOPUNDER
	-F	INPBUF,G,256	; COMMAND INPUT BUFFER FOLLOWS EXPANSION BUFFER
	-F	,B,8		; 8 BYTES BEFORE AFTER BUFFER FOR SLOPOVER

;
; Input reading and processing routines and data
;
	-F	PMPTLEN,W	; LENGTH OF CURRENT PROMPT STRING
	-F	,W		; SPARE
	-F	PMPTADDR	; ADDRESS OF CURRENT PROMPT STRING
	-F	PROMPTRTN	; ADDRESS OF PROMPT ROUTINE
	-F	READRTN		; ADDRESS OF CONTINUATION INPUT ROUTINE
	-F	ERRORRTN	; ADDRESS OF CHARACTER INPUT ERROR ROUTINE
	-F	SPECRTN		; ADDRESS OF SPECIAL CHARACTER PROCESSING RTN

;
; Restul parse descriptors and pointers
;
	-F	RESULT,G,1536	; RESULT PARSE DESCRIPTOR AREA (96 MAX)
	-F	RSLEND,L	; ADDRESS OF LAST TOKEN DESCRIPTOR
	-F	RSLNXT,L	; ADDRESS OF NEXT FREE TOKEN DESCRIPTOR

;
; Command definition information
;
	-F	VERB		; ADDRESS OF ASCIC VERB NAME
	-F	VERBTYP,B	; COMMAND VERB TYPE (SEE $CLIVERBDEF)
	-F	CMDOPT,B	; QUALIFIER # CAUSING THE FIRST SYNTAX CHANGE
	-F	VALLEV,B	; DEPTH OF CURRENT VALUE ON THE COMMAND LINE
	-F	RECALLCNT,B	; NUMBER OF RECALL COMMANDS ISSUES
	-F	PROPTR		; ADDRESS OF PARAMETER ENTITY BLOCK LIST
	-F	QUABLK		; ADDRESS OF QUALIFIER ENTITY BLOCK LIST
	-F	PARMCNT,B	; CURRENT PARAMETER COUNT
	-F	PARMSUM,B	; NUMBER OF PARAMETER VALUES
	-F	MAXPARM,B	; MAXIMUM NUMBER OF PARAMETERS ALLOWED
	-F	MINPARM,B	; MINIMUM NUMBER OF PARAMETERS REQUIRED
	-F	PAROUT		; ADDRESS OF LISTS OF OUTPUTS
	-F	SIGNALRTN	; ADDRESS OF ERROR SIGNALING ROUTINE
	-F	,L		; SPARE
	-F	TAB_VEC		; ADDRESS OF COMMAND TABLE VECTOR
	-F	IMAGE		; ADDRESS OF IMAGE NAME STRING; OR TABLE INDEX
	-F	DISALLOW	; ADDRESS OF DISALLOW EXPRESSION TREE
	-F	RECALLPTR	; POINTER INTO THE RECALL BUFFER
	-F	IMGCHAN,W	; IMAGE ACTIVATION CHANNEL NUMBER

;
; Flags describing the command line
; 
	-F	FLAGS,W		; COMMAND LEVEL FLAGS
	V	<M
		RUNDWN		; RUNDOWN HAS BEEN DONE
		COMMAND		; COMMAND (IMAGE) EXECUTION IN PROGRESS
				; (SO, AVOID PRINTING ERROR SEGMENT TEXT)
		PROMPT		; PROMPTING IN PROGRESS
		CONTIN		; CONTINUATION IN PROGRESS
		QUOTE		; PROCESSING QUOTED STRING
		STAR		; ASTERISK IS TERMINATOR
		VERB		; PROCESSING VERB
		INQUIRE		; INQUIRE COMMAND - READ REQUIRED
		NOSTAT		; DON'T STORE SUCCESS STATUS ON COMPLETION
		TRAILSPC	; TRAILING SPACES IN CONTINUED LINE
		INPSUBST	; CURRENTLY SUBSTITUTING INPUT RECORD SYMBOLS
		NOUPCASE	; DON'T UPCASE CHARACTERS FROM INPUT BUFFER
		COMMENT		; WE ARE WITHIN A COMMENT DURING "INPSUBST"
				; (SO, SUPPRESS ANY ERRORS DURING SUBSTITUTION)
		USRMODE		; USER MODE PARSE IS BEING PERFORMED
		ESCAPE		; ESCAPE SEQUENCE IS BEING PROCESSED
		>

	-F	FLAGS2,W	; MORE COMMAND LEVEL FLAGS
	V	<M
		CLIRTN		; COMMAND INVOKES A INTERNAL CLI ROUTINE
		USERRTN		; COMMAND INVOKES A USER-SPECIFIED ROUTINE
		CLOSERR		; SUPPRESS 'CLOSE' ERROR MESSAGE.
		>

;
; Saved context registers
;
	-F	SAVSP		; SAVED STACK POINTER
	-F	SAVAP		; SAVED ARGUMENT POINTER
	-F	SAVFP		; SAVED INITIAL FRAME POINTER
	E


;
;	DEFINE RESULT PARSE POINTERS.  EACH POINTER DESCRIBES
;	A TOKEN ON THE COMMAND LINE FROM LEFT TO RIGHT.
;

	STRUCT	PTR
	F	DESCR,L		; FIRST LONGWORD
	S	VALUE,0,B	; LOW BYTE IS TOKEN LENGTH
	V	<
		VALUE,8		; ITEM LENGTH
		OFFSET,12	; ITEM OFFSET IN BUFFER
		FLAGS,4		; ITEM FLAGS
		TERM,4		; ITEM TERMINATOR CLASS NUMBER
		TYPE,4		; ITEM TYPE
		>
	V	<		; FLAG BIT DEFINITIONS
		,20
		NEGATE		; QUALIFIER WAS NEGATED
		KEYWORD		; VALUE IS A KEYWORD
		SYNTAX		; CAUSED TRANSITION TO NEW COMMAND SYNTAX
		>
	C	<,_K_,1		; DEFINE TERMINATOR CLASSES, STARTING AT 1
		BLANK		; BLANK
		COLON		; COLON
		SLASH		; SLASH
		PLUS		; PLUS SIGN
		COMMA		; COMMA
		RPAREN		; RIGHT PARENTHESIS
		LPAREN		; LEFT PARENTHESIS
		>
	C	<,_K_,0		; DEFINE TYPE NUMBERS, STARTING AT 0
		COMDQUAL	; COMMAND QUALIFIER
		PARMQUAL	; PARAMETER QUALIFIER
		QUALVALU	; QUALIFIER VALUE
		PARAMETR	; PARAMETER
		ENDLINE		; END OF LINE
		IGNORE		; INVALIDATED DESCRIPTOR
		>

	F	LEVEL,B		; VALUE LEVEL
	F	NUMBER,B	; KEYWORD NUMBER
	F	PARMCNT,B	; PARAMETR COUNT
	F	,B		; SPARE

	F	ENTITY		; ENTITY BLOCK ADDRESS
	L	LENGTH		; FIXED LENGTH OF DESCRIPTOR
	E

;
;	DEFINE PARAMETER LIST MARKER.  EACH MARKER DESCRIBES
;	THE STARTING THRU ENDING POINTERS WHICH DESCRIBE A
;	GIVEN PARAMETER (INCLUDING QUALIFIERS AND VALUES).
;

	STRUCT	PLM
	F	NXTDESC,B	; NEXT DESCRIPTOR TO BE EXAMINED IN CURRENT LIST
	F	FSTDESC,B	; FIRST DESCRIPTOR IN LIST
	F	LSTDESC,B	; LAST DESCRIPTOR IN LIST
	M	1
	F	TRMDESC,B	; TERMINATOR DESCRIPTOR
	L	SIZE		; SIZE OF EACH ENTRY
	P	1
	F	QUADESC,B	; FIRST POSSIBLE QUALIFIER DESCRIPTOR
	E

;
;	DEFINE STORAGE USED BY OLD CLI INTERFACE.
;
;	THE MEMORY FOR THIS AREA IS SUPPLIED BY THE CALLING PROGRAM.
;

	STRUCT	RPW		; RESULT PARSE WORK AREA
	F	USERCTX		; USER CONTEXT LONGWORD
	F	DCLWRK		; ADDRESS OF COMMAND WORK AREA
	F	STRPARM,B	; INDEX TO FIRST PARAMETER DESCRIPTOR
	F	LSTDESC,B	; INDEX TO LAST PARAMETER DESCRIPTOR
	F	,B,2		; SPARE
	F	,L,5		; SPARE
	F	BITS,G,32	; 256 BITS, 1 IF PLM PROCESSED BY RESULT PARSE
	L	HDRSIZ		; SIZE OF FIXED PORTION
	F	PRMLIM,G,64	; UP TO 16 PARAMETER LIMIT DESCRIPTORS (PLM)
	L	LENGTH		; LENGTH OF MAXIMUM SIZE
	E

;
;	DEFINE STORAGE USED BY NEW CLI INTERFACE
;

	STRUCT	DCL
	F	PRMLIM,L,16		; Parameter limit descriptors
	C	CONTEXT,7		; Number of levels of context
	F	ENTITY,L,7		; Context entity block addresses
	F	TOKEN,L,7		; Context token desc addresses
	F	QUAL			; Address of last qualifier token
	F	GETVM			; Address of LIB$GET_VM
	F	FREEVM			; Address of LIB$FREE_VM
	F	DEFLEN,W		; Length of default value
	F	,W
	F	DEFADDR,L		; Address of default buffer
	F	FLAGS,B			; Flags byte
	V	<
		NOWRKAREA		; True if invalid WRK area pointer
		NEXTQUAL		; True if processing DCL$NEXTQUAL
		>
	F	BUFLEN,W		; Length of default value buffer
	F	PARAM,B			; Last parameter # requested
	L	SIZE
	E

;
;	DEFINE SYMBOL TABLE ENTRY
;

	STRUCT	SYM
	C	MAXSTATES,64	; MAXIMUM NUMBER OF KEYPAD STATES ALLOWED
	F	FL		; SYMBOL ENTRY FORWARD LINK
	F	BL		; SYMBOL ENTRY BACKWARD LINK
	F	SIZE,W		; SIZE OF SYMBOL TABLE ENTRY
	F	TYPE,B		; TYPE OF SYMBOL
	C	<,_K_
		STRING		; VALUE IS VARIABLE LENGTH STRING
		PERM		; PERMANENT SYMBOL, STRING
		BINARY		; VALUE IS BINARY LONGWORD VALUE
		LABEL		; VALUE IS RFA OF LINE WITH LABEL
		KEYPAD		; KEYPAD SYMBOL
		>
	M	1
	F	NONUNIQUE,B	; LENGTH OF NAME PORTION WHICH IS NONUNIQUE
				; (THAT IS, # CHARS AFTER UNIQUENESS POINT)
	P	1
	F	FLAGS,B		; KEYPAD FLAGS
	V	<M
		ECHO		; ECHO THE SUBSTITUTED COMMAND
		TERMINATE	; TREAT THE KEY AS A TERMINATOR
		STATE		; STATE SHOULD BE SET
		LOCK		; SET THE STATE UNTIL EXPLICITLY RESET
		ERASE		; ERASE THE LINE BEFORE EXECUTING THE KEY
		>
	F	SYMBOL,T	; ASCIC SYMBOL NAME
;
; SYMBOL VALUE DIRECTLY FOLLOWS:
;   FOR STRING: WORD-COUNTED STRING
;   FOR BINARY: LONGWORD
;   FOR LABELS: WORD OF 6, FOLLOWED BY 6 BYTE RFA
;   FOR KEYPAD: WORD-COUNTED STRING OF THE FOLLOWING FORMAT
;	WORD - SIZE OF STRING
;	WORD - SIZE OF VALUE STRING
;	VALUE STRING
;	BYTE - SIZE OF STRING DESCRIBING THE STATE WHEN THIS
;		SYMBOL IS DEFINED
;	STRING DESCRIBING THE STATE WHEN THIS SYMBOL IS DEFINED
;	BYTE - SIZE OF STRING DESCRIBING THE STATE THIS SYMBOL SETS
;	STRING DESCRIBING THE STATE THIS SYMBOL SETS
;
	E

;
;	DEFINE INDIRECT STACK FRAME
;

	STRUCT	IDF
	F	LNK		; POINTER TO NEXT INDIRECT FILE FRAME
	F	INPIFI,W	; IFI FOR INPUT
	F	ONLEVEL,W	; ON ERROR LEVEL NUMBER
	F	ONERROR		; ADDRESS OF ON ERROR COMMAND TEXT
	F	INPRABCTX	; CONTENTS OF INPUT RAB CTX LONGWORD
	F	LOCAL,Q		; LOCAL SYMBOL TABLE LISTHEAD
	F	LABEL,Q		; LABEL SYMBOL TABLE LISTHEAD
;
;    OUTIFI, OUTISI, OUTRABCTX, OUTDVI, and OUTFLAGS must be the same in PRC, 
;    IDF, OUT
;
	F	OUTIFI,W	; IFI FOR OUTPUT
	F	OUTISI,W	; ISI FOR OUTPUT
	F	OUTRABCTX	; CONTENTS OF OUTPUT RAB CTX LONGWORD
	F	OUTDVI,T,16	; INDIRECT OUTPUT DEVICE (ASCIC)
	F	OUTFLAGS,B	; FLAGS
	V	<M		;
		OUTCCL		; CONCEALED OUTPUT DEVICE
		INPCCL		; CONCEALED INPUT DEVICE
		>		;
	F	,B,3		; SPARE

	F	INPDVI,T,16	; INDIRECT INPUT DEVICE (ASCIC)
	F	INPFID,W,3	; FILE ID FOR INPUT FILE
	F	INPDID,W,3	; DIRECTORY ID FOR INPUT FILE
	F	INPRFA,W,3	; RECORD FILE ADDRESS FOR INPUT
	F	FLAG,W		; INDIRECT FLAGS
	V	<
		INPOPN		; THIS INPUT OPEN IS REQUIRED
		REMOTE		; COMMAND PROCEDURE EXISTS ON REMOTE NODE
		>
	F	ONCTLY		; SAVED ADDRESS OF ON CONTROL/Y COMMAND
	F	SEARCHCTX	; LISTHEAD OF F$SEARCH CONTEXT BLOCKS:
				;   1ST LONGWORD = LINK POINTER, 0 TO END
				;   2ND LONGWORD = SIZE OF BLOCK IN BYTES
	F	FILENAME	; ADDRESS OF ASCIC COMMAND PROCEDURE NAME
	F	,W,3
	F	,B,2
	L	LENGTH		; LENGTH OF INDIRECT FRAME
	E

;
; TEMPORARY STORAGE USED FOR SPAWNING SUBPROCESSES
;

	STRUCT	SPWN

	F	LINK,L		; POINTER TO NEXT IN CHAIN
	F	SIZE,W		; SIZE OF BLOCK
	F	,W		; UNUSED
	F	UNIT,W		; TERMINATION MAILBOX UNIT NUMBER
	F	CHAN,W		; CONTEXT MAILBOX CHANNEL
	F	FLAGS,W		; FLAGS
	V	<M
		LOG		; /LOG SPECIFIED
		PRCNAM		; /PROCESS_NAME SPECIFIED
		WAIT		; /WAIT SPECIFIED
		AUTOLOGO	; SILENT LOGOUT AFTER CMDSTR EXECUTED
		MODE		; BATCH/INTERACTIVE MODE OF SUBPROCESS
		CLISYM		; COPY CLI SYMBOLS TO SUBPROCESS
		LOGNAM		; COPY LOGICAL NAMES TO SUBPROCESS
		ACTIVE		; PROCESS CURRENTLY BEING SPAWNED
		NOTIFY		; /NOTIFY SPECIFIED
		PROMPT		; /PROMPT SPECIFIED
		INPUT		; /INPUT=value SPECIFIED
		OUTPUT		; OUTPUT IS SET TO SYS$OUTPUT
		KEYPAD		; COPY KEYPAD STATE TO SUBPROCESS
		CLI		; /CLI=value SPECIFIED
		NOCTX		; PASS/NOPASS CONTEXT TO SUBPROCESS
		TABLE		; /TABLE=value SPECIFIED
		>
	F	ACMODE,B	; ACCESS MODE TO CALL ASTADR AST ROUTINE
				; OR TO PROBE STSADR LONGWORD
	F	EFN,B		; EVENT FLAG TO SET WHEN SUBPROCESS COMPLETES
				; (-1 IF NONE)
	F	MBXNAM,Q	; DESCRIPTOR OF CONTEXT MAILBOX NAME
	F	PRCNAM,Q	; DESCRIPTOR OF PROCESS NAME
	F	INPUT,Q		; DESCRIPTOR OF SUBPROCESS INPUT FILESPEC
	F	OUTPUT,Q	; DESCRIPTOR OF SUBPROCESS OUTPUT FILESPEC
	F	CMDSTR,Q	; DESCRIPTOR OF COMMAND STRING TO BE EXECUTED
	F	IOSB,Q		; I/O STATUS BLOCK FOR QIO REQUESTS
	F	SUBPID,L	; PID OF NEWLY CREATED SUBPROCESS
	F	STATUS,L	; FINAL STATUS FROM COMPLETED SUBPROCESS
	F	PRIB,L		; BASE PRIORITY OF SUBPROCESS
	F	ASTADR,L	; AST ROUTINE TO CALL ON SUBPROCESS
				; TERMINATION (ZERO IF NONE)
	F	ASTPRM,L	; PARAMETER TO AST ROUTINE
	F	STSADR,L	; ADDRESS OF LONGWORD TO RECEIVE
				; TERMINATION STATUS (ZERO IF NONE)
	F	OUTOFBAND,L	; OUT-OF-BAND AST CHARACTER MASK
	F	IMAGCNT,L	; PROCESS IMAGE COUNT
	F	QUOTAS,G,50	; SPACE FOR SUBPROCESS QUOTA LIST
	F	PROCESS,T,16	; ASCIC SUBPROCESS NAME

	; Prompt string must be kept together (and mimicked in PRC and CTX)

	F	PROMPTLEN,B	; LENGTH OF PROMPT STRING
	F	PMPTCTRL,W	; PROMPT CONTROL CHARACTERS
	F	CONTINUE,B	; PROMPT CONTINUATION CHARACTER
	F	PROMPT,G,32	; PROMPT STRING AREA
	F	CLI,Q		; DESCRIPTOR OF CLI NAME
	F	TABLE,Q		; DESCRIPTOR OF CLI TABLE NAME

	L	LENGTH
	E

;
; FORMAT OF THE CONTEXT MESSAGES WHICH ARE TRANSMITTED FROM THE SPAWN
; COMMAND TO THE SUBPROCESS INITIALIZATION.
;

	STRUCT	CTX

	C	MAXLEN,1024	; MAXIMUM RECORD SIZE

	F	TYPE,W		; MESSAGE TYPE
	C	<
		HEADER		; HEADER RECORD
		CMDSTR		; COMMAND STRING
		LOGNAM		; LOGICAL NAMES
		CLISYM		; CLI SYMBOLS
		KEYSTATE	; KEYPAD STATE
		LNMTABLE	; LOGICAL NAME TABLE
		LNMNAME		; LOGICAL NAME BLOCK (INITIAL RECORD)
		LNMNTRAN	; ADDITIONAL TRANSLATIONS (NYI)		
		>
	M	1

	; FOR HEADER RECORDS

	F	PROCPRIV,Q	; PROCESS PRIVILEGES
	F	OUTOFBAND,L	; OUT-OF-BAND AST CHARACTER MASK
	V	<M
		,20		; SKIP UNUSED CHARACTERS
		CTRLT		; CONTROL T
		,4		; SKIP UNUSED CHARACTERS
		CTRLY		; CONTROL Y
		>
	F	FLAGS,B		; FLAGS BYTE
	V	<M
		AUTOLOGO	; SILENT LOGOUT AFTER COMMAND STRING EXECUTED
				; (IF OFF, REVERT TO SYS$INPUT AFTER EXECUTION)
		MODE		; BATCH/INTERACTIVE MODE BIT
		VERIFY		; VERIFICATION FLAG
		VERIMAGE	; IMAGE VERIFICATION FLAG
		WAIT		; WAIT/NOWAIT SUBPROCESS BIT
		>

	; Prompt string must be kept together (and mimicked in PRC and SPWN)

	F	PROMPTLEN,B	; LENGTH OF PROMPT STRING
	F	PMPTCTRL,W	; PROMPT CONTROL CHARACTERS
	F	CONTINUE,B	; PROMPT CONTINUATION CHARACTER
	F	PROMPT,G,32	; PROMPT STRING AREA

	L	HDRLEN		; FIXED SIZE OF HEADER RECORD


	; FOR COMMAND STRING RECORDS

	P	1
	F	CMDSTR,T	; ASCII COMMAND STRING (NO COUNT)

	; FOR LOGICAL NAME RECORDS

	P	1
	F	ENTSIZE,W	; SIZE OF ENTRY
	F	ACMODE,B	; ACCESS MODE OF LOGICAL NAME
	M	2
	F	LOGNAM,T	; ASCIC LOGICAL NAME
				; WORD-COUNTED VALUE STRING FOLLOWS

	; FOR CLI SYMBOL RECORDS

	P	1
	F	,W		; SIZE OF ENTRY
	F	SYMTAB,B	; SYMBOL TABLE TYPE
	C	<
		GLOBAL
		LOCAL
		KEYTABL
		>
	F	SYMTYPE,B	; SYMBOL TYPE
	C	<
		STRING		; VALUE IS VARIABLE LENGTH STRING
		PERM		; PERMANENT SYMBOL, STRING
		BINARY		; VALUE IS BINARY LONGWORD VALUE
		LABEL		; DUMMY - LABELS ARE NOT PASSED
		KEYPAD		; VALUE IS A KEYPAD SYMBOL
		>
	F	NONUNIQUE,B	; LENGTH OF NON-UNIQUE PORTION OF NAME
				; (I.E. # CHARS AFTER UNIQUENESS POINT)
	F	SYMBOL,T	; ASCIC SYMBOL NAME
				; SYMBOL VALUE DIRECTLY FOLLOWS:
				;   FOR STRING: WORD-COUNTED STRING
				;   FOR BINARY: LONGWORD

	; FOR KEYPAD STATE RECORD

	P	1
	F	KEYLENGTH,B	; STATE LENGTH
	F	KEYSTATE,T	; ASCII STATE NAME

	; FOR LOGICAL NAME TABLE RECORDS (LNMTABLE)

	P	2
	F	TFLAGS,B	; TABLE FLAGS
	F	PROT,W		; PROTECTION MASK
	F	QUOTA,L		; TABLE QUOTA
	F	LNMTABLE,T	; ASCIC LOGICAL NAME FOR TABLE
				; ASCIC PARENT TABLE NAME FOLLOWS

	; FOR LOGICAL NAME RECORDS (LNMNAME & LNMNTRAN)

	P	2
	F	NFLAGS,B	; NAME FLAGS OF LOGICAL NAME
	F	TRANCNT,B	; NUMBER OF TRANSLATIONS
	F	LNMNAME,T	; ASCIC PARENT TABLE NAME
				; ASCIC LOGICAL NAME FOLLOWS
				; ASCIC EQUIVLAENCE NAME(S) FOLLOW
				; TERMINATED BY A FLAG BYTE 

	E


;
; TERMINATION MAILBOX LIST ITEM
;

	STRUCT	TMBX

	C	MAXREFS,4	; MAXIMUM NUMBER OF SUBPROCESSES USING A
				;   SINGLE TERMINATION MAILBOX
	F	LINK,L		; POINTER TO NEXT ITEM
	F	UNIT,W		; MAILBOX UNIT NUMBER
	F	CHANNEL,W	; MAILBOX CHANNEL NUMBER
	F	REFS,B		; NUMBER OF SUBPROCESSES CURRENTLY USING 
				;   THIS MAILBOX
	F	,B		; UNUSED
	F	SIZE,W		; SIZE OF BLOCK
	F	PRC,L		; ADDRESS OF PROCESS WORK AREA
	L	LENGTH		; SIZE OF STRUCTURE
	E


;
; OUTPUT FILE INFORMATION
;
;    OUTIFI, OUTISI, OUTRABCTX, OUTDVI, and OUTFLAGS must be the same in PRC, 
;    IDF, OUT
;
	STRUCT	OUT
	F	OUTIFI,W	; IFI FOR OUTPUT
	F	OUTISI,W	; ISI FOR OUTPUT
	F	OUTRABCTX	; CONTENTS OF OUTPUT RAB CTX LONGWORD
	F	OUTDVI,T,16	; INDIRECT OUTPUT DEVICE (ASCIC)
	F	OUTFLAGS,B	; FLAGS
	V	<M		;
		OUTCCL		; CONCEALED OUTPUT DEVICE
		INPCCL		; CONCEALED INPUT DEVICE
		>		;
	F	,B,3		; SPARE
	L	LENGTH		; SIZE OF STRUCTURE
	E	


;
; EDIT FLAGS
;
	STRUCT	EDIT
	F	FLAGS,B		; FLAGS BYTE
	V	<M
		UNCOMMENT
		COMPRESS
		COLLAPSE
		TRIM
		UPCASE
		LOWERCASE
		EOL
		>
	E	
